---
title: "Intoduction into Adjusted Predictions and Marginal Effects"
author: "Daniel LÃ¼decke"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Intoduction into Adjusted Predictions and Marginal Effects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r set-options, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "png",
  fig.width = 7,
  fig.height = 3.5,
  message = FALSE, warning = FALSE)
options(width = 800)

if (!requireNamespace("ggplot2", quietly = TRUE) ||
    !requireNamespace("margins", quietly = TRUE)) {
  knitr::opts_chunk$set(eval = FALSE)
}
```

# Marginal Effects, (Adjusted) Predictions, Estimated Marginal Means

There is no common language across fields regarding a unique meaning of "marginal effects". Thus, the wording throughout this package may vary. The most generic description of what *ggeffects* does, is: *ggeffects* allows us to interpret a statistical model by making predictions generated by the model when one holds the non-focal variables constant and varies the focal variable(s).

In the following, some examples are shown to make clear what is actually calculated and returned by the package's functions `ggprecict()`, `ggemmeans()` and `ggeffect()`, and how this differs from other functions or software packages that calculate marginal effects.

## A simple example with a linear model

First, we fit s simple linear model and look at the coefficient of the only predictor, `Sepal.Width`.

```{r}
data(iris)
model1 <- lm(Sepal.Length ~ Sepal.Width, data = iris)
coef(model1)["Sepal.Width"]
```

The coefficient we see here, is in this simple case the _slope_ of the regression line:

```{r}
library(ggplot2)
ggplot(iris, aes(x = Sepal.Width, y = Sepal.Length)) + 
  geom_point() +
  geom_abline(intercept = coef(model1)["(Intercept)"], 
              slope = coef(model1)["Sepal.Width"])
```

In this simple case of a linear model, the slope for this regression line is always the same for each value of our predictor, `Sepal.Width`. We can check this by generating predictions of our model.

```{r}
library(ggeffects)
pr <- ggpredict(model1, "Sepal.Width")
pr
```

"Predictions" returned by *ggeffects* are actually interpretations of regression coefficients in terms of _comparison_. We can compare how much our outcome (`Sepal.Length`) changes on average, when the focal term (in this case: `Sepal.Width`) varies: For example, what is the average value of `Sepal.Length` for observations with a value of, say, `2` for `Sepal.Width`, compared to observations with a `3` for `Sepal.Width`?

*ggeffects* returns predictions for [representative values](https://strengejacke.github.io/ggeffects/articles/introduction_effectsatvalues.html) for the focal term, hence you see many predicted values (including confidence intervals) in the ouput for the different values of the focal term(s).

If we now look at the differences between any two predicted values, we see that these are identical:

```{r}
# Difference between predicted values for Sepal.Width = 2 and 3
pr <- ggpredict(model1, "Sepal.Width [2,3]")
round(diff(pr$predicted), 4)

# Difference between predicted values for Sepal.Width = 3 and 4
pr <- ggpredict(model1, "Sepal.Width [4,5]")
round(diff(pr$predicted), 4)
```

Furthermore, the difference of predicted values that differ by `1` in the focal term (`Sepal.Width`), equal the regression coefficient. This is because the interpretation of a regression coefficient can be seen as average difference in the outcome, "comparing two individuals that differ in one predictor [a difference of `1` for `Sepal.Width` in this case], while being at the same levels of all other predictors." (Gelman, Hill, Vehtari 2020, page 494). We don't have any further co-variates in this example, so we won't demonstrate this further now.

Thus, the association - or _effect_ - between `Sepal.Length` and `Sepal.Width` is the same for every value of `Sepal.Width`. This means, that for simple linear models, the regression coefficient is also the _marginal effect_:

```{r}
library(margins)
margins(model1)
```

The _marginal effect_ here is the _average marginal effect_, because on average, the effect of `Sepal.Width` on `Sepal.Length` is `r round(as.vector(coef(model1)["Sepal.Width"]), 4)`.
